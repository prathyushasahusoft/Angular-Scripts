{"version":3,"sources":["ngDialog.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ngDialog.js","sourcesContent":["/*\n * ngDialog - easy modals and popup windows\n * http://github.com/likeastore/ngDialog\n * (c) 2013-2015 MIT License, https://likeastore.com\n */\n\n(function (root, factory) {\n    if (typeof module !== 'undefined' && module.exports) {\n        // CommonJS\n        module.exports = factory(require('angular'));\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(['angular'], factory);\n    } else {\n        // Global Variables\n        factory(root.angular);\n    }\n}(this, function (angular) {\n    'use strict';\n\n    var m = angular.module('ngDialog', []);\n\n    var $el = angular.element;\n    var isDef = angular.isDefined;\n    var style = (document.body || document.documentElement).style;\n    var animationEndSupport = isDef(style.animation) || isDef(style.WebkitAnimation) || isDef(style.MozAnimation) || isDef(style.MsAnimation) || isDef(style.OAnimation);\n    var animationEndEvent = 'animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend';\n    var focusableElementSelector = 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]';\n    var forceBodyReload = false;\n    var scopes = {};\n    var openIdStack = [];\n    var keydownIsBound = false;\n\n    m.provider('ngDialog', function () {\n        var defaults = this.defaults = {\n            className: 'ngdialog-theme-default',\n            plain: false,\n            showClose: true,\n            closeByDocument: true,\n            closeByEscape: true,\n            closeByNavigation: false,\n            appendTo: false,\n            preCloseCallback: false,\n            overlay: true,\n            cache: true,\n            trapFocus: true,\n            preserveFocus: true,\n            ariaAuto: true,\n            ariaRole: null,\n            ariaLabelledById: null,\n            ariaLabelledBySelector: null,\n            ariaDescribedById: null,\n            ariaDescribedBySelector: null\n        };\n\n        this.setForceBodyReload = function (_useIt) {\n            forceBodyReload = _useIt || false;\n        };\n\n        this.setDefaults = function (newDefaults) {\n            angular.extend(defaults, newDefaults);\n        };\n\n        var globalID = 0, dialogsCount = 0, closeByDocumentHandler, defers = {};\n\n        this.$get = ['$document', '$templateCache', '$compile', '$q', '$http', '$rootScope', '$timeout', '$window', '$controller', '$injector',\n            function ($document, $templateCache, $compile, $q, $http, $rootScope, $timeout, $window, $controller, $injector) {\n                var $body = $document.find('body');\n                if (forceBodyReload) {\n                    $rootScope.$on('$locationChangeSuccess', function () {\n                        $body = $document.find('body');\n                    });\n                }\n\n                var privateMethods = {\n                    onDocumentKeydown: function (event) {\n                        if (event.keyCode === 27) {\n                            publicMethods.close('$escape');\n                        }\n                    },\n\n                    activate: function($dialog) {\n                        var options = $dialog.data('$ngDialogOptions');\n\n                        if (options.trapFocus) {\n                            $dialog.on('keydown', privateMethods.onTrapFocusKeydown);\n\n                            // Catch rogue changes (eg. after unfocusing everything by clicking a non-focusable element)\n                            $body.on('keydown', privateMethods.onTrapFocusKeydown);\n                        }\n                    },\n\n                    deactivate: function ($dialog) {\n                        $dialog.off('keydown', privateMethods.onTrapFocusKeydown);\n                        $body.off('keydown', privateMethods.onTrapFocusKeydown);\n                    },\n\n                    deactivateAll: function () {\n                        angular.forEach(function(el) {\n                            var $dialog = angular.element(el);\n                            privateMethods.deactivate($dialog);\n                        });\n                    },\n\n                    setBodyPadding: function (width) {\n                        var originalBodyPadding = parseInt(($body.css('padding-right') || 0), 10);\n                        $body.css('padding-right', (originalBodyPadding + width) + 'px');\n                        $body.data('ng-dialog-original-padding', originalBodyPadding);\n                    },\n\n                    resetBodyPadding: function () {\n                        var originalBodyPadding = $body.data('ng-dialog-original-padding');\n                        if (originalBodyPadding) {\n                            $body.css('padding-right', originalBodyPadding + 'px');\n                        } else {\n                            $body.css('padding-right', '');\n                        }\n                    },\n\n                    performCloseDialog: function ($dialog, value) {\n                        var id = $dialog.attr('id');\n                        var scope = scopes[id];\n\n                        if (!scope) {\n                            // Already closed\n                            return;\n                        }\n\n                        if (typeof $window.Hammer !== 'undefined') {\n                            var hammerTime = scope.hammerTime;\n                            hammerTime.off('tap', closeByDocumentHandler);\n                            hammerTime.destroy && hammerTime.destroy();\n                            delete scope.hammerTime;\n                        } else {\n                            $dialog.unbind('click');\n                        }\n\n                        if (dialogsCount === 1) {\n                            $body.unbind('keydown');\n                        }\n\n                        if (!$dialog.hasClass('ngdialog-closing')){\n                            dialogsCount -= 1;\n                        }\n\n                        var previousFocus = $dialog.data('$ngDialogPreviousFocus');\n                        if (previousFocus) {\n                            previousFocus.focus();\n                        }\n\n                        $rootScope.$broadcast('ngDialog.closing', $dialog);\n                        dialogsCount = dialogsCount < 0 ? 0 : dialogsCount;\n                        if (animationEndSupport) {\n                            scope.$destroy();\n                            $dialog.unbind(animationEndEvent).bind(animationEndEvent, function () {\n                                $dialog.remove();\n                                if (dialogsCount === 0) {\n                                    $body.removeClass('ngdialog-open');\n                                    privateMethods.resetBodyPadding();\n                                }\n                                $rootScope.$broadcast('ngDialog.closed', $dialog);\n                            }).addClass('ngdialog-closing');\n                        } else {\n                            scope.$destroy();\n                            $dialog.remove();\n                            if (dialogsCount === 0) {\n                                $body.removeClass('ngdialog-open');\n                                privateMethods.resetBodyPadding();\n                            }\n                            $rootScope.$broadcast('ngDialog.closed', $dialog);\n                        }\n                        if (defers[id]) {\n                            defers[id].resolve({\n                                id: id,\n                                value: value,\n                                $dialog: $dialog,\n                                remainingDialogs: dialogsCount\n                            });\n                            delete defers[id];\n                        }\n                        if (scopes[id]) {\n                            delete scopes[id];\n                        }\n                        openIdStack.splice(openIdStack.indexOf(id), 1);\n                        if (!openIdStack.length) {\n                            $body.unbind('keydown', privateMethods.onDocumentKeydown);\n                            keydownIsBound = false;\n                        }\n                    },\n\n                    closeDialog: function ($dialog, value) {\n                        var preCloseCallback = $dialog.data('$ngDialogPreCloseCallback');\n\n                        if (preCloseCallback && angular.isFunction(preCloseCallback)) {\n\n                            var preCloseCallbackResult = preCloseCallback.call($dialog, value);\n\n                            if (angular.isObject(preCloseCallbackResult)) {\n                                if (preCloseCallbackResult.closePromise) {\n                                    preCloseCallbackResult.closePromise.then(function () {\n                                        privateMethods.performCloseDialog($dialog, value);\n                                    });\n                                } else {\n                                    preCloseCallbackResult.then(function () {\n                                        privateMethods.performCloseDialog($dialog, value);\n                                    }, function () {\n                                        return;\n                                    });\n                                }\n                            } else if (preCloseCallbackResult !== false) {\n                                privateMethods.performCloseDialog($dialog, value);\n                            }\n                        } else {\n                            privateMethods.performCloseDialog($dialog, value);\n                        }\n                    },\n\n                    onTrapFocusKeydown: function(ev) {\n                        var el = angular.element(ev.currentTarget);\n                        var $dialog;\n\n                        if (el.hasClass('ngdialog')) {\n                            $dialog = el;\n                        } else {\n                            $dialog = privateMethods.getActiveDialog();\n\n                            if ($dialog === null) {\n                                return;\n                            }\n                        }\n\n                        var isTab = (ev.keyCode === 9);\n                        var backward = (ev.shiftKey === true);\n\n                        if (isTab) {\n                            privateMethods.handleTab($dialog, ev, backward);\n                        }\n                    },\n\n                    handleTab: function($dialog, ev, backward) {\n                        var focusableElements = privateMethods.getFocusableElements($dialog);\n\n                        if (focusableElements.length === 0) {\n                            if (document.activeElement) {\n                                document.activeElement.blur();\n                            }\n                            return;\n                        }\n\n                        var currentFocus = document.activeElement;\n                        var focusIndex = Array.prototype.indexOf.call(focusableElements, currentFocus);\n\n                        var isFocusIndexUnknown = (focusIndex === -1);\n                        var isFirstElementFocused = (focusIndex === 0);\n                        var isLastElementFocused = (focusIndex === focusableElements.length - 1);\n\n                        var cancelEvent = false;\n\n                        if (backward) {\n                            if (isFocusIndexUnknown || isFirstElementFocused) {\n                                focusableElements[focusableElements.length - 1].focus();\n                                cancelEvent = true;\n                            }\n                        } else {\n                            if (isFocusIndexUnknown || isLastElementFocused) {\n                                focusableElements[0].focus();\n                                cancelEvent = true;\n                            }\n                        }\n\n                        if (cancelEvent) {\n                            ev.preventDefault();\n                            ev.stopPropagation();\n                        }\n                    },\n\n                    autoFocus: function($dialog) {\n                        var dialogEl = $dialog[0];\n\n                        // Browser's (Chrome 40, Forefix 37, IE 11) don't appear to honor autofocus on the dialog, but we should\n                        var autoFocusEl = dialogEl.querySelector('*[autofocus]');\n                        if (autoFocusEl !== null) {\n                            autoFocusEl.focus();\n\n                            if (document.activeElement === autoFocusEl) {\n                                return;\n                            }\n\n                            // Autofocus element might was display: none, so let's continue\n                        }\n\n                        var focusableElements = privateMethods.getFocusableElements($dialog);\n\n                        if (focusableElements.length > 0) {\n                            focusableElements[0].focus();\n                            return;\n                        }\n\n                        // We need to focus something for the screen readers to notice the dialog\n                        var contentElements = privateMethods.filterVisibleElements(dialogEl.querySelectorAll('h1,h2,h3,h4,h5,h6,p,span'));\n\n                        if (contentElements.length > 0) {\n                            var contentElement = contentElements[0];\n                            $el(contentElement).attr('tabindex', '-1').css('outline', '0');\n                            contentElement.focus();\n                        }\n                    },\n\n                    getFocusableElements: function ($dialog) {\n                        var dialogEl = $dialog[0];\n\n                        var rawElements = dialogEl.querySelectorAll(focusableElementSelector);\n\n                        return privateMethods.filterVisibleElements(rawElements);\n                    },\n\n                    filterVisibleElements: function (els) {\n                        var visibleFocusableElements = [];\n\n                        for (var i = 0; i < els.length; i++) {\n                            var el = els[i];\n\n                            if (el.offsetWidth > 0 || el.offsetHeight > 0) {\n                                visibleFocusableElements.push(el);\n                            }\n                        }\n\n                        return visibleFocusableElements;\n                    },\n\n                    getActiveDialog: function () {\n                        var dialogs = document.querySelectorAll('.ngdialog');\n\n                        if (dialogs.length === 0) {\n                            return null;\n                        }\n\n                        // TODO: This might be incorrect if there are a mix of open dialogs with different 'appendTo' values\n                        return $el(dialogs[dialogs.length - 1]);\n                    },\n\n                    applyAriaAttributes: function ($dialog, options) {\n                        if (options.ariaAuto) {\n                            if (!options.ariaRole) {\n                                var detectedRole = (privateMethods.getFocusableElements($dialog).length > 0) ?\n                                    'dialog' :\n                                    'alertdialog';\n\n                                options.ariaRole = detectedRole;\n                            }\n\n                            if (!options.ariaLabelledBySelector) {\n                                options.ariaLabelledBySelector = 'h1,h2,h3,h4,h5,h6';\n                            }\n\n                            if (!options.ariaDescribedBySelector) {\n                                options.ariaDescribedBySelector = 'article,section,p';\n                            }\n                        }\n\n                        if (options.ariaRole) {\n                            $dialog.attr('role', options.ariaRole);\n                        }\n\n                        privateMethods.applyAriaAttribute(\n                            $dialog, 'aria-labelledby', options.ariaLabelledById, options.ariaLabelledBySelector);\n\n                        privateMethods.applyAriaAttribute(\n                            $dialog, 'aria-describedby', options.ariaDescribedById, options.ariaDescribedBySelector);\n                    },\n\n                    applyAriaAttribute: function($dialog, attr, id, selector) {\n                        if (id) {\n                            $dialog.attr(attr, id);\n                        }\n\n                        if (selector) {\n                            var dialogId = $dialog.attr('id');\n\n                            var firstMatch = $dialog[0].querySelector(selector);\n\n                            if (!firstMatch) {\n                                return;\n                            }\n\n                            var generatedId = dialogId + '-' + attr;\n\n                            $el(firstMatch).attr('id', generatedId);\n\n                            $dialog.attr(attr, generatedId);\n\n                            return generatedId;\n                        }\n                    }\n                };\n\n                var publicMethods = {\n\n                    /*\n                     * @param {Object} options:\n                     * - template {String} - id of ng-template, url for partial, plain string (if enabled)\n                     * - plain {Boolean} - enable plain string templates, default false\n                     * - scope {Object}\n                     * - controller {String}\n                     * - controllerAs {String}\n                     * - className {String} - dialog theme class\n                     * - showClose {Boolean} - show close button, default true\n                     * - closeByEscape {Boolean} - default true\n                     * - closeByDocument {Boolean} - default true\n                     * - preCloseCallback {String|Function} - user supplied function name/function called before closing dialog (if set)\n                     *\n                     * @return {Object} dialog\n                     */\n                    open: function (opts) {\n                        var options = angular.copy(defaults);\n                        var localID = ++globalID;\n                        var dialogID = 'ngdialog' + localID;\n                        openIdStack.push(dialogID);\n\n                        opts = opts || {};\n                        angular.extend(options, opts);\n\n                        var defer;\n                        defers[dialogID] = defer = $q.defer();\n\n                        var scope;\n                        scopes[dialogID] = scope = angular.isObject(options.scope) ? options.scope.$new() : $rootScope.$new();\n\n                        var $dialog, $dialogParent;\n\n                        var resolve = angular.extend({}, options.resolve);\n\n                        angular.forEach(resolve, function (value, key) {\n                            resolve[key] = angular.isString(value) ? $injector.get(value) : $injector.invoke(value, null, null, key);\n                        });\n\n                        $q.all({\n                            template: loadTemplate(options.template || options.templateUrl),\n                            locals: $q.all(resolve)\n                        }).then(function (setup) {\n                            var template = setup.template,\n                                locals = setup.locals;\n\n                            $templateCache.put(options.template || options.templateUrl, template);\n\n                            if (options.showClose) {\n                                template += '<div class=\"ngdialog-close\"></div>';\n                            }\n\n                            $dialog = $el('<div id=\"ngdialog' + localID + '\" class=\"ngdialog\"></div>');\n                            $dialog.html((options.overlay ?\n                                '<div class=\"ngdialog-overlay\"></div><div class=\"ngdialog-content\" role=\"document\">' + template + '</div>' :\n                                '<div class=\"ngdialog-content\" role=\"document\">' + template + '</div>'));\n\n                            $dialog.data('$ngDialogOptions', options);\n\n                            if (options.data && angular.isString(options.data)) {\n                                var firstLetter = options.data.replace(/^\\s*/, '')[0];\n                                scope.ngDialogData = (firstLetter === '{' || firstLetter === '[') ? angular.fromJson(options.data) : options.data;\n                            } else if (options.data && angular.isObject(options.data)) {\n                                scope.ngDialogData = options.data;\n                            }\n\n                            if (options.controller && (angular.isString(options.controller) || angular.isArray(options.controller) || angular.isFunction(options.controller))) {\n\n                                var ctrl = options.controller;\n                                if (options.controllerAs && angular.isString(options.controllerAs)) {\n                                    ctrl += ' as ' + options.controllerAs;\n                                }\n\n                                var controllerInstance = $controller(ctrl, angular.extend(\n                                    locals,\n                                    {\n                                        $scope: scope,\n                                        $element: $dialog\n                                    }\n                                ));\n                                $dialog.data('$ngDialogControllerController', controllerInstance);\n                            }\n\n                            if (options.className) {\n                                $dialog.addClass(options.className);\n                            }\n\n                            if (options.appendTo && angular.isString(options.appendTo)) {\n                                $dialogParent = angular.element(document.querySelector(options.appendTo));\n                            } else {\n                                $dialogParent = $body;\n                            }\n\n                            privateMethods.applyAriaAttributes($dialog, options);\n\n                            if (options.preCloseCallback) {\n                                var preCloseCallback;\n\n                                if (angular.isFunction(options.preCloseCallback)) {\n                                    preCloseCallback = options.preCloseCallback;\n                                } else if (angular.isString(options.preCloseCallback)) {\n                                    if (scope) {\n                                        if (angular.isFunction(scope[options.preCloseCallback])) {\n                                            preCloseCallback = scope[options.preCloseCallback];\n                                        } else if (scope.$parent && angular.isFunction(scope.$parent[options.preCloseCallback])) {\n                                            preCloseCallback = scope.$parent[options.preCloseCallback];\n                                        } else if ($rootScope && angular.isFunction($rootScope[options.preCloseCallback])) {\n                                            preCloseCallback = $rootScope[options.preCloseCallback];\n                                        }\n                                    }\n                                }\n\n                                if (preCloseCallback) {\n                                    $dialog.data('$ngDialogPreCloseCallback', preCloseCallback);\n                                }\n                            }\n\n                            scope.closeThisDialog = function (value) {\n                                privateMethods.closeDialog($dialog, value);\n                            };\n\n                            $timeout(function () {\n                                var $activeDialogs = document.querySelectorAll('.ngdialog');\n                                privateMethods.deactivateAll($activeDialogs);\n\n                                $compile($dialog)(scope);\n                                var widthDiffs = $window.innerWidth - $body.prop('clientWidth');\n                                $body.addClass('ngdialog-open');\n                                var scrollBarWidth = widthDiffs - ($window.innerWidth - $body.prop('clientWidth'));\n                                if (scrollBarWidth > 0) {\n                                    privateMethods.setBodyPadding(scrollBarWidth);\n                                }\n                                $dialogParent.append($dialog);\n\n                                privateMethods.activate($dialog);\n\n                                if (options.trapFocus) {\n                                    privateMethods.autoFocus($dialog);\n                                }\n\n                                if (options.name) {\n                                    $rootScope.$broadcast('ngDialog.opened', {dialog: $dialog, name: options.name});\n                                } else {\n                                    $rootScope.$broadcast('ngDialog.opened', $dialog);\n                                }\n                            });\n\n                            if (!keydownIsBound) {\n                                $body.bind('keydown', privateMethods.onDocumentKeydown);\n                                keydownIsBound = true;\n                            }\n\n                            if (options.closeByNavigation) {\n                                $rootScope.$on('$locationChangeSuccess', function () {\n                                    privateMethods.closeDialog($dialog);\n                                });\n                            }\n\n                            if (options.preserveFocus) {\n                                $dialog.data('$ngDialogPreviousFocus', document.activeElement);\n                            }\n\n                            closeByDocumentHandler = function (event) {\n                                var isOverlay = options.closeByDocument ? $el(event.target).hasClass('ngdialog-overlay') : false;\n                                var isCloseBtn = $el(event.target).hasClass('ngdialog-close');\n\n                                if (isOverlay || isCloseBtn) {\n                                    publicMethods.close($dialog.attr('id'), isCloseBtn ? '$closeButton' : '$document');\n                                }\n                            };\n\n                            if (typeof $window.Hammer !== 'undefined') {\n                                var hammerTime = scope.hammerTime = $window.Hammer($dialog[0]);\n                                hammerTime.on('tap', closeByDocumentHandler);\n                            } else {\n                                $dialog.bind('click', closeByDocumentHandler);\n                            }\n\n                            dialogsCount += 1;\n\n                            return publicMethods;\n                        });\n\n                        return {\n                            id: dialogID,\n                            closePromise: defer.promise,\n                            close: function (value) {\n                                privateMethods.closeDialog($dialog, value);\n                            }\n                        };\n\n                        function loadTemplateUrl (tmpl, config) {\n                            return $http.get(tmpl, (config || {})).then(function(res) {\n                                return res.data || '';\n                            });\n                        }\n\n                        function loadTemplate (tmpl) {\n                            if (!tmpl) {\n                                return 'Empty template';\n                            }\n\n                            if (angular.isString(tmpl) && options.plain) {\n                                return tmpl;\n                            }\n\n                            if (typeof options.cache === 'boolean' && !options.cache) {\n                                return loadTemplateUrl(tmpl, {cache: false});\n                            }\n\n                            return $templateCache.get(tmpl) || loadTemplateUrl(tmpl, {cache: true});\n                        }\n                    },\n\n                    /*\n                     * @param {Object} options:\n                     * - template {String} - id of ng-template, url for partial, plain string (if enabled)\n                     * - plain {Boolean} - enable plain string templates, default false\n                     * - name {String}\n                     * - scope {Object}\n                     * - controller {String}\n                     * - controllerAs {String}\n                     * - className {String} - dialog theme class\n                     * - showClose {Boolean} - show close button, default true\n                     * - closeByEscape {Boolean} - default false\n                     * - closeByDocument {Boolean} - default false\n                     * - preCloseCallback {String|Function} - user supplied function name/function called before closing dialog (if set); not called on confirm\n                     *\n                     * @return {Object} dialog\n                     */\n                    openConfirm: function (opts) {\n                        var defer = $q.defer();\n\n                        var options = {\n                            closeByEscape: false,\n                            closeByDocument: false\n                        };\n                        angular.extend(options, opts);\n\n                        options.scope = angular.isObject(options.scope) ? options.scope.$new() : $rootScope.$new();\n                        options.scope.confirm = function (value) {\n                            defer.resolve(value);\n                            var $dialog = $el(document.getElementById(openResult.id));\n                            privateMethods.performCloseDialog($dialog, value);\n                        };\n\n                        var openResult = publicMethods.open(options);\n                        openResult.closePromise.then(function (data) {\n                            if (data) {\n                                return defer.reject(data.value);\n                            }\n                            return defer.reject();\n                        });\n\n                        return defer.promise;\n                    },\n\n                    isOpen: function(id) {\n                        var $dialog = $el(document.getElementById(id));\n                        return $dialog.length > 0;\n                    },\n\n                    /*\n                     * @param {String} id\n                     * @return {Object} dialog\n                     */\n                    close: function (id, value) {\n                        var $dialog = $el(document.getElementById(id));\n\n                        if ($dialog.length) {\n                            privateMethods.closeDialog($dialog, value);\n                        } else {\n                            if (id === '$escape') {\n                                var topDialogId = openIdStack[openIdStack.length - 1];\n                                $dialog = $el(document.getElementById(topDialogId));\n                                if ($dialog.data('$ngDialogOptions').closeByEscape) {\n                                    privateMethods.closeDialog($dialog, value);\n                                }\n                            }\n                        }\n\n                        return publicMethods;\n                    },\n\n                    closeAll: function (value) {\n                        var $all = document.querySelectorAll('.ngdialog');\n\n                        // Reverse order to ensure focus restoration works as expected\n                        for (var i = $all.length - 1; i >= 0; i--) {\n                            var dialog = $all[i];\n                            privateMethods.closeDialog($el(dialog), value);\n                        }\n                    },\n\n                    getDefaults: function () {\n                        return defaults;\n                    }\n                };\n\n                return publicMethods;\n            }];\n    });\n\n    m.directive('ngDialog', ['ngDialog', function (ngDialog) {\n        return {\n            restrict: 'A',\n            scope: {\n                ngDialogScope: '='\n            },\n            link: function (scope, elem, attrs) {\n                elem.on('click', function (e) {\n                    e.preventDefault();\n\n                    var ngDialogScope = angular.isDefined(scope.ngDialogScope) ? scope.ngDialogScope : 'noScope';\n                    angular.isDefined(attrs.ngDialogClosePrevious) && ngDialog.close(attrs.ngDialogClosePrevious);\n\n                    var defaults = ngDialog.getDefaults();\n\n                    ngDialog.open({\n                        template: attrs.ngDialog,\n                        className: attrs.ngDialogClass || defaults.className,\n                        controller: attrs.ngDialogController,\n                        controllerAs: attrs.ngDialogControllerAs,\n                        scope: ngDialogScope,\n                        data: attrs.ngDialogData,\n                        showClose: attrs.ngDialogShowClose === 'false' ? false : (attrs.ngDialogShowClose === 'true' ? true : defaults.showClose),\n                        closeByDocument: attrs.ngDialogCloseByDocument === 'false' ? false : (attrs.ngDialogCloseByDocument === 'true' ? true : defaults.closeByDocument),\n                        closeByEscape: attrs.ngDialogCloseByEscape === 'false' ? false : (attrs.ngDialogCloseByEscape === 'true' ? true : defaults.closeByEscape),\n                        preCloseCallback: attrs.ngDialogPreCloseCallback || defaults.preCloseCallback\n                    });\n                });\n            }\n        };\n    }]);\n\n    return m;\n}));\n"],"sourceRoot":"/source/"}